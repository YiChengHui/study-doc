## 文件
>   文件系统的用户接口包括文件**的命名、类型、属性和对文件的操作**

### 文件命名
>   所有操作系统都允许用**1～8个字母组成的字符串**

多数操作系统都支持文件名用圆点隔开分为两部分，圆点后面的部分称为文件扩展名

### 文件结构
1.  无结构字节序列（流式文件）  
    优点: **提供灵活性**

2.  固定长度记录序列   
    中心思想: **读操作返回一个记录,写操作重写或追加一个记录**

3.  树形结构  
    记录长度不定,在记录的固定位置包含一个**关键字域**,记录树**按关键字域排序**

### 文件类型
1.  正规文件
    -   ASCII文件: 可显示和打印，通常的文本编辑器可编辑
    -   二进制文件: 不能直接显示和打印，需要专门编辑器

2.  目录文件  
    管理文件系统的**系统文件**

3.  字符设备文件  
    和**输入输出**有关

4.  块设备文件  
    用于**磁盘类**设备

### 文件存取

1.  顺序存取  
    早期，从文件开始处读取信息，不能跳过
2.  随机存取  
    又称直接存取，可以以任意顺序读取文件信息

### 文件属性
除了文件名和文件数据外，其他与文件相关的信息，如创建日期、文件大小、修改时间

### 文件操作
1.  CREATE 创建
1.  DELETE 删除
1.  OPEN 打开
1.  CLOSE 关闭
1.  READ 读
1.  WRITE 写
1.  APPEND 文件末尾添加数据
1.  SEEK 找到读取位置
1.  GETATTRIBUTES 获取文件属性
1.  SETATTRIBUTES 设置文件属性
1.  RENAME 重命名

## 目录
>   目录是文件系统中实现**按名访问**的重要数据结构

### 目录文件的结构
>   目录文件有两种常见的结构：属性放在**目录项**中和放在**i结点**中

### 目录结构
1.  单层目录（根目录）  
    问题：**文件命名、搜索效率低**

![](./image/1.png)

2.  两级目录  
    -   优点：**解决重名问题，查找快**  
    -   缺点：**增加系统开销**

![](./image/2.png)

3.  树形目录  
    -   优点： 
        **便于文件分类、 层次结构清晰、 便于管理和保护、 解决了重名问题、 查找速度加快**
    -   缺点：  
        **结构相对复杂**

![](./image/3.png)

### 路径名
采用树形目录时，需要有某种方法指明文件

1.  绝对路径名  
    从根目录到文件
2.  相对路径名  
    从当前工作目录到文件

### 目录操作
1.  CREATE 创建
1.  DELETE 删除
1.  OPENDIR 打开目录
1.  CLOSEDIR 关闭目录
1.  READDIR 读目录
1.  RENAME 重命名

## 文件系统的实现

### 实现文件
1.  连续分配  
    把每个文件作为一连串的数据块放在磁盘上  
    -   优点
    >   **实现简单**，记录每个文件用到的簇仅需存储两个数字即可：**第一块的磁盘地址和文件的块数**。  
    >   **读操作性能好**，在单个操作中就能从磁盘上读取整个文件。
    -   缺点
    >   磁盘变得零碎，**空闲的连续簇形成“空洞”**

    ![连续分配](./image/4.png)

2.  磁盘链接表  
    为每个文件构造簇的链接表，每个簇开始的几个字节用于存放下一个簇的簇号，簇的其他部分存放数据，每个文件可以存放在不连续的簇中。
    -   优点
    >   **充分利用每个簇**，不会因为磁盘碎片而浪费空间，管理也比较简单。
    -   缺点
    >   **随机存取相当缓慢**，要获得文件的第n块，每一次都要从头开始读取前面的n-1块。

    ![连续分配](./image/5.png)

3.  内存的链接分配表  
    将文件所在的磁盘的簇号放在内存的表(文件分配表)中，MS-DOS采用
    -   缺点
    >   必须把**整个表都存放在内存中**，磁盘容量很大时，表占的内存比较大。

    ![连续分配](./image/6.png)

4.  i-结点  
    为每个文件赋予一个被称为i结点的数据结构，其中列出了文件属性和文件块的磁盘地址

    ![连续分配](./image/7.png)

### 实现目录

1.  CP/M中的目录

    >   CP/M以**簇**而不是以字节**为单位**来记录文件长度的

    ![连续分配](./image/10.png)

2.  MS-DOS中的目录  
    >   使用**文件分配表FAT**作为索引表来存放文件数据所在簇的簇号

    ![连续分配](./image/8.png)


3.  UNIX中的目录  
    ![连续分配](./image/9.png)

### 磁盘空间管理

>   簇大小  
>   文件系统为文件分配磁盘空间以簇为单位  
>   簇大小过大：容易造成空间浪费  
>   簇大小过小：文件跨越簇，访问文件时间延长


>   一般簇大小是**2的整数次幂个连续的扇区**  
>   如1个扇区，512个字节；  
>   连续2个扇区，大小为1KB；  
>   连续4个扇区，大小为2KB。

1.  记录空闲块  
    跟踪记录空闲块的两种常用方法

2.  空闲簇链接表  
    用一些空闲簇存放空闲簇的簇号

3.  位图  
    用**n位**位图对应磁盘的**n个簇**空闲簇用1表示已分配簇用0表示


